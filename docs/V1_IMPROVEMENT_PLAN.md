# V1 算法改进建议

基于最新的基准测试，当前仅保留 V1 语义匹配算法。为了在保持 V1 稳定性的前提下进一步提升自动对齐质量，可以按以下路线逐步增强：

1. **句子级预切分 + 带权匹配**
   - 先根据句末标点（。！？；……）、双换行和 Markdown 项目符号将脚本切分为自然句。
   - 为每个句子记录开始/结束索引，匹配时仅在少量相邻句子里做 `SequenceMatcher`，避免跨章匹配。
   - 给包含专有名词或高频关键词的句子更高权重，优先与对应字幕对齐。

2. **滑动指针与剩余片段管理**
   - V1 当前对每条字幕都会在全局脚本中搜索，这会导致重复使用同一段文本。可增加“消费指针”，每次匹配成功后将指针移动到该片段末尾附近，再在可配置的窗口范围内搜索，以保持顺序一致。
   - 如果匹配失败，则扩大窗口或回退指针，确保长句不会被截断。

3. **词级约束与软行宽**
   - 对匹配结果在切分行时引入中文分词/标点优先策略：优先在标点或词边界换行，避免出现“词语被折断”的情况。
   - 若字幕长度严重不足，可允许在保持时轴不变的前提下扩展行数或追加空行提示，让人工审校时更容易发现异常。

4. **混合相似度模型**
   - 除 `SequenceMatcher` 外，再计算一个基于 TF-IDF 或小型句向量（如 `text-embedding-3-small` 等）的余弦相似度，将两者按权重组合，提高在口语/方言场景下的鲁棒性。
   - 可以为“人名、地点”等关键实体设置硬性校验，如果匹配结果不包含这些实体，则自动降权。

5. **逐条差异报告**
   - 结合基准工具输出“低于阈值”的条目和对应脚本 context，帮助人工快速定位问题。
   - 为 Web 界面增加“低置信度”提示或排序，人工可从问题最大的条目开始校对。

按照上述路径，每一步都可以独立落地并在 `scripts/run_benchmark.py` 中量化收益，逐渐把 V1 的平均相似度推近人工校正水平。***
